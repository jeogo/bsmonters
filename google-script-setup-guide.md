# 🚀 دليل إعداد Google Apps Script المحسّن

## 📋 الخطوات المطلوبة

### 1. إنشاء Google Apps Script جديد
1. اذهب إلى [script.google.com](https://script.google.com)
2. انقر على "مشروع جديد"
3. احذف الكود الموجود واستبدله بالكود من `google-apps-script-optimized.js`

### 2. تعديل الإعدادات في الكود
```javascript
const CONFIG = {
  // إعدادات Telegram (اختياري)
  TELEGRAM_BOT_TOKEN: 'YOUR_BOT_TOKEN_HERE', // ضع توكن البوت هنا
  TELEGRAM_CHAT_ID: 'YOUR_CHAT_ID_HERE',     // ضع chat ID هنا
  
  // إعدادات الإيميل
  EMAIL_ENABLED: true,                        // true لتفعيل الإيميل
  NOTIFICATION_EMAIL: 'your-email@gmail.com', // ضع إيميلك هنا
  
  // إعدادات أخرى
  SPREADSHEET_ID: null, // اتركه null ليتم إنشاء جدول تلقائياً
  SHEET_NAME: 'الطلبات',
  ENABLE_DETAILED_LOGS: false // true للتطوير، false للإنتاج
};
```

### 3. تفعيل الصلاحيات المطلوبة
1. في محرر السكربت، انقر على "المكتبات" من القائمة اليسرى
2. أضف الخدمات التالية:
   - **Gmail API** (لإرسال الإيميلات)
   - **Google Sheets API** (لحفظ البيانات)
   - **URL Fetch** (لإرسال Telegram)

### 4. نشر السكربت
1. انقر على "نشر" → "نشر جديد"
2. اختر نوع النشر: **تطبيق ويب**
3. الوصف: "سكربت طلبات الساعات"
4. التنفيذ: **أنا**
5. الوصول: **أي شخص** (مهم جداً!)
6. انقر "نشر"
7. **انسخ رابط التطبيق** (سنحتاجه لاحقاً)

### 5. تحديث كود الموقع
في ملف `src/app/page.tsx`، استبدل:
```typescript
const API_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID_HERE/exec";
```
بالرابط الذي حصلت عليه من الخطوة 4.

### 6. إعداد الإيميل التلقائي

#### ✅ نعم، يمكنك إرسال الإيميلات لنفسك!
- **Gmail تلقائي**: السكربت سيرسل لك إيميل فوري لكل طلب
- **من نفس الحساب**: سيرسل من حساب Gmail الخاص بك إلى نفسك
- **محتوى غني**: إيميل HTML منسق بجميع تفاصيل الطلب
- **رابط مباشر**: للوصول للجدول فوراً

#### تفعيل الإيميل:
```javascript
EMAIL_ENABLED: true,
NOTIFICATION_EMAIL: 'your-email@gmail.com', // ضع إيميلك هنا
```

### 7. اختبار السكربت
```javascript
// في محرر Google Apps Script، شغّل هذه الدالة للاختبار
function testScript() {
  // الكود موجود في الملف، فقط شغّله
}
```

## 🚀 المميزات الجديدة

### ⚡ السرعة والأداء
- **معالجة محسّنة**: أقل من ثانيتين لمعظم الطلبات
- **كتابة مباشرة**: إدراج في Google Sheets بدون تأخير
- **إشعارات متوازية**: لا تؤثر على سرعة الاستجابة

### 📊 Google Sheets المحسّن
- **إنشاء تلقائي**: ينشئ الجدول والورقة تلقائياً
- **تنسيق جميل**: ألوان وتنسيق احترافي
- **رؤوس ثابتة**: سهولة في التصفح
- **حالات الطلب**: تتبع حالة كل طلب

### 📧 إشعارات ذكية
- **إيميل فوري**: تفاصيل كاملة منسقة
- **Telegram**: إشعار سريع للهاتف
- **HTML غني**: تصميم احترافي للإيميل
- **روابط مباشرة**: للوصول السريع

### 🔒 الأمان والموثوقية
- **تحقق شامل**: من جميع البيانات المدخلة
- **معالجة أخطاء**: شاملة لجميع الحالات
- **CORS صحيح**: يعمل من أي موقع
- **تسجيل متقدم**: لتتبع الأداء

## 🛠️ استكشاف الأخطاء

### إذا لم تصل الإيميلات:
1. تأكد من `EMAIL_ENABLED: true`
2. تحقق من صحة الإيميل في `NOTIFICATION_EMAIL`
3. تأكد من صلاحيات Gmail API

### إذا لم يحفظ في Google Sheets:
1. تحقق من صلاحيات Google Sheets API
2. تأكد من نشر السكربت بصلاحية "أي شخص"

### إذا ظهر خطأ CORS:
1. تأكد من نشر السكربت كـ "تطبيق ويب"
2. تحقق من أن الوصول مضبوط على "أي شخص"

## 📞 الدعم الفني
إذا واجهت أي مشاكل، تحقق من:
1. **السجلات**: في Google Apps Script → عرض → تسجيلات التنفيذ
2. **الأخطاء**: في وحدة تحكم المتصفح
3. **الصلاحيات**: تأكد من الموافقة على جميع الصلاحيات المطلوبة

---

🎉 **مبروك!** سكريبتك الآن محسّن للسرعة والكفاءة القصوى!
